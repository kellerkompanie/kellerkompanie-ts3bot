#!/usr/bin/make -f

export DH_VERBOSE = 1

%:
	dh $@

override_dh_auto_build:
	# Create Python virtual environment and install package + PyInstaller
	python3 -m venv build/venv
	build/venv/bin/pip install --upgrade pip wheel
	build/venv/bin/pip install .
	build/venv/bin/pip install pyinstaller
	# Build binary with PyInstaller
	build/venv/bin/pyinstaller \
		--onefile \
		--log-level=WARN \
		--name keko-ts3bot \
		--collect-submodules=keko \
		--collect-submodules=pydantic \
		--collect-submodules=pydantic_settings \
		--collect-submodules=sqlalchemy \
		--collect-submodules=mariadb \
		--hidden-import=mariadb \
		--exclude-module=pysqlite2 \
		--exclude-module=MySQLdb \
		--exclude-module=psycopg2 \
		--exclude-module=cx_Oracle \
		keko/ts3bot/main.py

override_dh_auto_clean:
	dh_auto_clean
	rm -rf build/venv *.spec

override_dh_auto_test:
	# Skip tests during package build

override_dh_shlibdeps:
	# Skip shared library dependencies check
